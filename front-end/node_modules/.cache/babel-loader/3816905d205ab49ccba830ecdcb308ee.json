{"ast":null,"code":"import _classCallCheck from \"/mnt/c/Users/oscar/Documents/autoservicio-cartas-back/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/mnt/c/Users/oscar/Documents/autoservicio-cartas-back/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport Cookies from 'universal-cookie';\nimport FetchHttpClient, { form, header, json } from \"fetch-http-client/lib/index\";\nimport Notifications from './Notifications';\n\nvar API =\n/*#__PURE__*/\nfunction () {\n  function API() {\n    _classCallCheck(this, API);\n  }\n\n  _createClass(API, null, [{\n    key: \"call\",\n    value: function call(service) {\n      var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var responseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (response) {};\n      var errorFunc = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (response) {};\n      var wToken = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n      var client = new FetchHttpClient('https://api.tramitesescolares.com.mx/'); //let  client = new FetchHttpClient('http://localhost:8000/');\n\n      client.addMiddleware(form());\n      client.addMiddleware(json());\n\n      if (wToken) {\n        client.addMiddleware(header({\n          'Authorization': 'Token ' + localStorage.getItem('token')\n        }));\n      }\n\n      client.post(service, {\n        form: params\n      }).then(function (response) {\n        if (response.status === 200) {\n          //console.log(response.jsonData);\n          return responseFunc(response.jsonData);\n        } else if (response.status === 500) {\n          //console.log(response);\n          Notifications.openNotificationWithIcon('error', response.status + ' ' + response.statusText, \"\");\n          return errorFunc(response);\n        } else {\n          //console.log(response);\n          if (response.jsonData) {\n            Notifications.openNotificationWithIcon('error', \"\", response.jsonData.detail); //API.redirectTo('/login');\n          } else {\n            Notifications.openNotificationWithIcon('error', response.status + ' ' + response.statusText, \"\");\n          }\n\n          return errorFunc(response);\n        }\n      });\n    }\n  }, {\n    key: \"restCall\",\n    value: function restCall(options) {\n      var op = {\n        method: \"get\",\n        service: \"\",\n        params: \"\",\n        success: function success(response) {},\n        error: function error(response) {},\n        wToken: true\n      };\n\n      for (var key in options) {\n        op[key] = options[key];\n      }\n\n      var client = new FetchHttpClient('https://api.tramitesescolares.com.mx/'); //let  client = new FetchHttpClient('http://localhost:8000/');\n\n      client.addMiddleware(form());\n      client.addMiddleware(json());\n\n      if (op.wToken) {\n        client.addMiddleware(header({\n          'Authorization': 'Token ' + localStorage.getItem('token')\n        }));\n      }\n\n      client[op.method](op.service, {\n        form: op.params\n      }).then(function (response) {\n        //console.log(op.method)\n        if (response.status === 200) {\n          //console.log(response.jsonData);\n          return op.success(response.jsonData);\n        } else if (response.status === 500) {\n          //console.log(response);\n          Notifications.openNotificationWithIcon('error', response.status + ' ' + response.statusText, \"\");\n          return op.error(response);\n        } else {\n          //console.log(response);\n          if (response.jsonData) {\n            Notifications.openNotificationWithIcon('error', response.status + ' ' + response.statusText, response.jsonData.detail); //API.redirectTo('/login');\n          } else {\n            Notifications.openNotificationWithIcon('error', response.status + ' ' + response.statusText, \"\");\n          }\n\n          return op.error(response);\n        }\n      });\n    }\n  }, {\n    key: \"redirectTo\",\n    value: function redirectTo(to) {\n      if (API.bodySiteRef != null && API.bodySiteRef.current != null) {\n        //console.log(API.bodySiteRef);\n        API.bodySiteRef.current.history.push(to);\n      } else {\n        //API.bodySiteRef.current.history.push(to);\n        //document.getElementById(\"site_loader\").hidden = false;\n        window.location.href = \"/login\";\n      }\n    }\n  }, {\n    key: \"validateToken\",\n    value: function validateToken() {\n      if (localStorage.getItem('token') != null) {\n        return true;\n      } else {\n        API.logout();\n        return false;\n      }\n    }\n  }, {\n    key: \"logout\",\n    value: function logout() {\n      if (localStorage.getItem('token') != null) {\n        API.call(\"logout/\", {}, function (response) {\n          //console.log(response);\n          Notifications.openNotificationWithIcon('success', \"Sesión cerrada con éxito\", \"\");\n        });\n        localStorage.removeItem('token');\n        API.redirectTo('/login');\n      } else {\n        localStorage.removeItem('token'); //API.cookies.remove('token');\n\n        API.redirectTo('/login');\n      }\n    }\n  }, {\n    key: \"logoutUser\",\n    value: function logoutUser() {\n      if (localStorage.getItem('token') != null) {\n        API.call(\"logout/\", {}, function (response) {\n          //console.log(response);\n          Notifications.openNotificationWithIcon('success', \"Sesión cerrada con éxito\", \"\");\n        });\n        localStorage.removeItem('token');\n        API.redirectTo('/');\n      } else {\n        localStorage.removeItem('token'); //API.cookies.remove('token');\n\n        API.redirectTo('/');\n      }\n    }\n  }]);\n\n  return API;\n}();\n\nAPI.bodySiteRef = null;\nAPI.cookies = new Cookies();\nexport { API as default };","map":{"version":3,"sources":["/mnt/c/Users/oscar/Documents/autoservicio-cartas-back/front-end/src/tools/API.js"],"names":["Cookies","FetchHttpClient","form","header","json","Notifications","API","service","params","responseFunc","response","errorFunc","wToken","client","addMiddleware","localStorage","getItem","post","then","status","jsonData","openNotificationWithIcon","statusText","detail","options","op","method","success","error","key","to","bodySiteRef","current","history","push","window","location","href","logout","call","removeItem","redirectTo","cookies"],"mappings":"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","sourcesContent":["import Cookies from 'universal-cookie';\nimport FetchHttpClient, {form, header, json} from \"fetch-http-client/lib/index\";\nimport Notifications from './Notifications'\n\nexport default class API {\n\n    static bodySiteRef = null;\n    static cookies = new Cookies();\n\n    static call(service, params={}, responseFunc=(function(response){}),errorFunc=(function(response){}), wToken=true) {\n        let  client = new FetchHttpClient('https://api.tramitesescolares.com.mx/');\n        //let  client = new FetchHttpClient('http://localhost:8000/');\n        client.addMiddleware(form());\n        client.addMiddleware(json());\n\n        if (wToken) {\n            client.addMiddleware(header({'Authorization': 'Token ' + localStorage.getItem('token')}));\n        }\n\n        client.post(service, {form: params }).then(response => {\n            if (response.status === 200) {\n                //console.log(response.jsonData);\n                return responseFunc(response.jsonData);\n            } else if (response.status === 500)  {\n                //console.log(response);\n                Notifications.openNotificationWithIcon('error',response.status + ' ' + response.statusText,\"\");\n                return errorFunc(response);\n            } else {\n                //console.log(response);\n                if (response.jsonData) {\n                    Notifications.openNotificationWithIcon('error',\"\",response.jsonData.detail);\n                    //API.redirectTo('/login');\n                } else {\n                    Notifications.openNotificationWithIcon('error',response.status + ' ' + response.statusText,\"\");\n                }\n                return errorFunc(response);\n            }\n        });\n    }\n\n    static restCall(options) {\n        let op = {\n            method: \"get\",\n            service: \"\",\n            params: \"\",\n            success: (function(response){}),\n            error: (function(response){}),\n            wToken: true\n        }\n        for (var key in options) {\n            op[key] = options[key];\n        }\n\n        let  client = new FetchHttpClient('https://api.tramitesescolares.com.mx/');\n        //let  client = new FetchHttpClient('http://localhost:8000/');\n        client.addMiddleware(form());\n        client.addMiddleware(json());\n        if (op.wToken) {\n            client.addMiddleware(header({'Authorization': 'Token ' + localStorage.getItem('token')}));\n        }\n        client[op.method](op.service, {form: op.params}).then(response => {\n            //console.log(op.method)\n            if (response.status === 200) {\n                //console.log(response.jsonData);\n                return op.success(response.jsonData);\n            } else if (response.status === 500)  {\n                //console.log(response);\n                Notifications.openNotificationWithIcon('error',response.status + ' ' + response.statusText,\"\");\n                return op.error(response);\n            } else {\n                //console.log(response);\n                if (response.jsonData) {\n                    Notifications.openNotificationWithIcon('error',response.status + ' ' + response.statusText,response.jsonData.detail);\n                    //API.redirectTo('/login');\n                } else {\n                    Notifications.openNotificationWithIcon('error',response.status + ' ' + response.statusText,\"\");\n                }\n                return op.error(response);\n            }\n        });\n    }\n\n    static redirectTo(to) {\n        if (API.bodySiteRef != null && API.bodySiteRef.current != null) {\n            //console.log(API.bodySiteRef);\n            API.bodySiteRef.current.history.push(to);\n        } else {\n            //API.bodySiteRef.current.history.push(to);\n            //document.getElementById(\"site_loader\").hidden = false;\n            window.location.href = \"/login\";\n        }\n    }\n\n    static validateToken() {\n        if (localStorage.getItem('token') != null) {\n            return true;\n        } else {\n            API.logout();\n            return false;\n        }\n    }\n\n    static logout() {\n        if (localStorage.getItem('token')!= null) {\n            API.call(\"logout/\",{}, (response) => {\n                //console.log(response);\n                Notifications.openNotificationWithIcon('success',\"Sesión cerrada con éxito\",\"\");\n            });\n            localStorage.removeItem('token');\n            API.redirectTo('/login');\n        } else {\n            localStorage.removeItem('token');\n            //API.cookies.remove('token');\n            API.redirectTo('/login');\n        }\n    }\n\n    static logoutUser() {\n        if (localStorage.getItem('token')!= null) {\n            API.call(\"logout/\",{}, (response) => {\n                //console.log(response);\n                Notifications.openNotificationWithIcon('success',\"Sesión cerrada con éxito\",\"\");\n            });\n            localStorage.removeItem('token');\n            API.redirectTo('/');\n        } else {\n            localStorage.removeItem('token');\n            //API.cookies.remove('token');\n            API.redirectTo('/');\n        }\n    }\n}"]},"metadata":{},"sourceType":"module"}